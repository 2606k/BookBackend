# 图书商城API接口文档总览

## 系统简介
图书商城后端系统，基于Spring Boot开发，提供图书销售、订单管理、购物车、用户管理等功能。

## 技术栈
- **框架**: Spring Boot 3.x
- **数据库**: MySQL 8.0
- **ORM**: MyBatis Plus
- **支付**: 微信支付 V3
- **文件存储**: MinIO
- **认证**: 微信小程序 OpenID

## 接口文档列表

### 1. [OrderController - 订单管理](./OrderController接口文档.md)
**基础路径**: `/appoint`
- 创建订单并发起支付
- 查询订单状态
- 关闭订单
- 微信支付回调处理
- 申请退款（用户端）
- 执行退款（管理员端）
- 退款结果回调
- 订单列表查询

### 2. [CartController - 购物车管理](./CartController接口文档.md)
**基础路径**: `/cart`
- 添加商品到购物车
- 更新购物车商品数量
- 删除购物车商品
- 清空用户购物车
- 获取购物车列表
- 批量选中/取消选中商品
- 获取选中商品数量
- 获取选中的购物车项

### 3. [AddressController - 地址管理](./AddressController接口文档.md)
**基础路径**: `/address`
- 查询地址列表
- 添加收货地址

### 4. [AppointmentsController - 预约管理](./AppointmentsController接口文档.md)
**基础路径**: `/appoint`
- 添加预约记录
- 查询预约记录列表

### 5. [BrandsController - 书籍管理](./BrandsController接口文档.md)
**基础路径**: `/brand`
- 品牌管理页面
- 添加书籍
- 获取书籍列表
- 删除书籍

### 6. [CategoriesController - 分类管理](./CategoriesController接口文档.md)
**基础路径**: `/category`
- 分类管理页面
- 添加分类
- 获取分类列表
- 删除分类

### 7. [WeddingPhotoController - 照片管理](./WeddingPhotoController接口文档.md)
**基础路径**: `/wedding/photo`
- 上传照片
- 查询所有照片
- 按故事ID查询照片
- 删除照片

### 8. [WeddingUserController - 用户管理](./WeddingUserController接口文档.md)
**基础路径**: `/user`
- 用户注册
- 用户登录
- 登录页面
- 后台管理页面

## 数据库设计

### 核心表结构
- **books**: 书籍信息表
- **categories**: 分类信息表
- **orders**: 订单主表
- **order_items**: 订单详情表
- **cart**: 购物车表（新增）
- **address**: 收货地址表
- **appointments**: 预约记录表
- **wedding_users**: 用户信息表
- **wedding_photos**: 照片信息表

详细的购物车表结构请参考：[购物车数据库表结构](./购物车数据库表结构.md)

## 统一响应格式

### 成功响应
```json
{
  "code": 200,
  "msg": "成功",
  "data": "响应数据"
}
```

### 错误响应
```json
{
  "code": 500,
  "msg": "错误描述",
  "data": null
}
```

## 状态码说明
- **200**: 操作成功
- **500**: 服务器内部错误
- **400**: 参数错误
- **401**: 未授权
- **404**: 资源不存在

## 微信支付集成
系统集成了微信支付V3 API，支持：
- JSAPI支付（小程序支付）
- 支付结果回调
- 订单查询
- 退款申请
- 退款结果回调

## 文件存储
使用MinIO对象存储服务处理文件上传：
- 支持图片上传
- 自动生成访问URL
- 分布式存储

## 开发指南

### 环境配置
1. **Java**: JDK 17+
2. **数据库**: MySQL 8.0
3. **缓存**: Redis（可选）
4. **文件存储**: MinIO服务

### 配置文件
主要配置项在 `application.yml` 中：
- 数据库连接配置
- 微信支付配置
- MinIO配置
- 日志配置

### 部署说明
1. 确保数据库表结构已创建
2. 配置微信支付参数
3. 配置MinIO服务地址
4. 设置支付回调URL

## 安全考虑
1. **支付安全**: 微信支付回调需要验证签名
2. **数据验证**: 所有输入参数需要验证
3. **权限控制**: 管理端接口需要权限验证
4. **敏感数据**: 用户信息和支付信息加密存储

## 监控与日志
- 使用SLF4J进行日志记录
- 关键操作记录详细日志
- 支付相关操作特别记录
- 错误日志包含详细堆栈信息

## 版本更新记录
- **v1.0**: 基础订单系统
- **v1.1**: 新增购物车功能
- **v1.2**: 完善接口文档
