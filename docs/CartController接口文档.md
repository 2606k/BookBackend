# CartController 接口文档

## 概述
CartController是购物车管理控制器，负责处理购物车的增删改查功能。

**基础路径**: `/cart`

## 接口列表

### 1. 添加商品到购物车
- **接口**: `POST /cart/add`
- **功能**: 将商品添加到用户购物车
- **请求参数**:
```json
{
  "openid": "用户openid",
  "bookId": "书籍ID",
  "quantity": "购买数量"
}
```
- **响应结果**:
```json
{
  "code": 200,
  "msg": "添加成功",
  "data": null
}
```

### 2. 更新购物车商品数量
- **接口**: `PUT /cart/update/{cartId}`
- **功能**: 更新购物车中商品的数量
- **请求参数**:
  - `cartId`: 购物车ID（路径参数）
  - `quantity`: 新数量（查询参数）
- **响应结果**:
```json
{
  "code": 200,
  "msg": "更新成功",
  "data": null
}
```

### 3. 删除购物车商品
- **接口**: `DELETE /cart/remove/{cartId}`
- **功能**: 删除购物车中的商品
- **请求参数**:
  - `cartId`: 购物车ID（路径参数）
- **响应结果**:
```json
{
  "code": 200,
  "msg": "删除成功",
  "data": null
}
```

### 4. 清空用户购物车
- **接口**: `DELETE /cart/clear`
- **功能**: 清空用户的购物车
- **请求参数**:
  - `openid`: 用户openid（查询参数）
- **响应结果**:
```json
{
  "code": 200,
  "msg": "清空成功",
  "data": null
}
```

### 5. 获取用户购物车列表
- **接口**: `GET /cart/list`
- **功能**: 获取用户购物车中的所有商品
- **请求参数**:
  - `openid`: 用户openid（查询参数）
- **响应结果**:
```json
{
  "code": 200,
  "msg": "成功",
  "data": [
    {
      "id": "购物车ID",
      "openid": "用户openid",
      "bookId": "书籍ID",
      "bookName": "书籍名称",
      "price": "商品价格",
      "imageUrl": "商品图片URL",
      "quantity": "购买数量",
      "selected": "是否选中",
      "createdAt": "创建时间",
      "updatedAt": "更新时间"
    }
  ]
}
```

### 6. 批量选中/取消选中商品
- **接口**: `PUT /cart/select`
- **功能**: 批量设置商品的选中状态
- **请求参数**:
```json
{
  "cartIds": [1, 2, 3],
  "selected": true
}
```
- **响应结果**:
```json
{
  "code": 200,
  "msg": "更新成功",
  "data": null
}
```

### 7. 单个商品选中/取消选中
- **接口**: `PUT /cart/select/{cartId}`
- **功能**: 设置单个商品的选中状态
- **请求参数**:
  - `cartId`: 购物车ID（路径参数）
  - `selected`: 是否选中（查询参数）
- **响应结果**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

### 8. 获取选中商品数量
- **接口**: `GET /cart/selected/count`
- **功能**: 获取用户购物车中选中商品的数量
- **请求参数**:
  - `openid`: 用户openid（查询参数）
- **响应结果**:
```json
{
  "code": 200,
  "msg": "成功",
  "data": 3
}
```

### 9. 获取选中的购物车项
- **接口**: `GET /cart/selected`
- **功能**: 获取用户购物车中选中的商品（用于结算）
- **请求参数**:
  - `openid`: 用户openid（查询参数）
- **响应结果**:
```json
{
  "code": 200,
  "msg": "成功",
  "data": [
    {
      "id": "购物车ID",
      "openid": "用户openid",
      "bookId": "书籍ID",
      "bookName": "书籍名称",
      "price": "商品价格",
      "imageUrl": "商品图片URL",
      "quantity": "购买数量",
      "selected": true,
      "createdAt": "创建时间",
      "updatedAt": "更新时间"
    }
  ]
}
```

## 业务逻辑说明
1. **库存检查**: 添加和更新商品时会检查库存是否充足
2. **商品信息同步**: 获取购物车列表时会同步最新的商品信息（价格、名称等）
3. **下架商品处理**: 已下架的商品会被标记为不可选中状态
4. **默认选中**: 新添加的商品默认为选中状态
5. **重复添加**: 如果购物车中已有相同商品，会增加数量而不是新增记录

## 错误处理
所有接口在出现错误时返回统一格式：
```json
{
  "code": 500,
  "msg": "错误描述",
  "data": null
}
```

## 注意事项
1. 所有金额单位为分
2. 购物车项包含商品的冗余信息，用于提高查询性能
3. 商品信息（价格、名称等）在获取购物车列表时会实时更新
4. 购物车项的选中状态用于结算功能
